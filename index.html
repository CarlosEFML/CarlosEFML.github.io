<html>
<head>
  <script async src="https://api.kvstore.io/js/public.js?storage_uuid=a7630eeb-4619-45b5-bb1d-3c1833a6c877"></script>
  <script>
    function sendData() {
      window.post('new_collection', 'my-key', document.getElementById('val').value);
    }

    function reqListener () {
      console.log(this.responseText);
      document.getElementById('val').value = this.responseText;
    };

    function loadData(key) {
      var oReq = new XMLHttpRequest();
      oReq.onload = reqListener;
      oReq.open("get", "https://api.kvstore.io/collections/new_collection/items/" + key, true);
      oReq.setRequestHeader('kvstoreio_api_key', '593f80c2ba5b84871a40be8e498eb9c8083e57f5561f96121a7d4eefa3c52092');
      oReq.setRequestHeader('Access-Control-Allow-Headers', 'kvstoreio_api_key');
      
      oReq.send();
    }
    
    loadData("my-key");

    var items = [];
    function addItem() {
      var content = document.getElementById('content');
      var itemDiv = document.createElement('div');
      var keyLabel = document.createTextNode('Chave: ');
      var keyInput = document.createElement('input');
      var valueLabel = document.createTextNode('Valor: ');
      var valueInput = document.createElement('input');

      itemDiv.appendChild(keyLabel);
      itemDiv.appendChild(keyInput);
      itemDiv.appendChild(valueLabel);
      itemDiv.appendChild(valueInput);

      content.appendChild(itemDiv);

      items[items.length] = {
        "keyInput": keyInput,
        "valueInput": valueInput
      };
    }

    function saveDoc() {
      var docName = document.getElementById('doc').value;
      var docContent = {};

      for (i=0; i<items.length; i++) {
        docContent[items[i].keyInput.value] = items[i].valueInput.value;
      }

      window.post('new_collection', docName, JSON.stringify(docContent));
    }

    function loadDoc() {
      var docName = document.getElementById('doc').value;

      var oReq = new XMLHttpRequest();
      oReq.onload = function() {
        var doc = JSON.parse(this.responseText);
        window.alert(doc.value);
        window.alert(JSON.stringify(doc.value));

        var keys = Object.keys(doc.value);
        for (i=0; i<keys.length; i++) {
          addItem();
          items[items.length-1].keyInput.value = keys[i];
          items[items.length-1].valueInput.value = doc.value[keys[i]];
        }
      };
      oReq.open("get", "https://api.kvstore.io/collections/new_collection/items/" + docName, true);
      oReq.setRequestHeader('kvstoreio_api_key', '593f80c2ba5b84871a40be8e498eb9c8083e57f5561f96121a7d4eefa3c52092');
      oReq.setRequestHeader('Access-Control-Allow-Headers', 'kvstoreio_api_key');
      
      oReq.send();
    }
  </script>
</head>
  <div>Nome do documento::</div>
  <div><input id='doc' type='text'> <button onclick='loadDoc()'>Load</button></div>
  <div id='content'></div>
  <div><button onclick='addItem()'>Add</button></div>
  <div><button onclick='saveDoc()'>Save</button></div>
  

  <input id='val' type='text'>
  <button onclick='sendData()'>OI</button>
</html>

